<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: #0b1220;
      --card: #1a2332;
      --text: #e8edf4;
      --muted: #7d8a9a;
      --border: #2a3648;
      --good: #4ade80;
      --bad: #f87171;
      --primary: #3b82f6;
    }
    
    body {
      font-family: -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    header {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 16px;
    }
    
    h1 { font-size: 24px; margin-bottom: 16px; }
    
    .tabs {
      display: flex;
      gap: 8px;
    }
    
    .tab {
      flex: 1;
      padding: 12px 8px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }
    
    .tab.active {
      background: var(--primary);
      color: white;
    }
    
    .tab-icon { font-size: 24px; display: block; margin-bottom: 4px; }
    .tab-label { font-size: 12px; }
    
    main {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    main[hidden] { display: none; }
    
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .card-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 500;
      cursor: pointer;
      font-size: 32px;
      transition: transform 0.2s;
    }
    
    .btn:hover { transform: scale(1.05); }
    .btn:active { transform: scale(0.95); }
    
    .actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .btn-yes { background: var(--good); flex: 1; }
    .btn-no { background: var(--bad); flex: 1; }
    .btn-na { background: var(--muted); flex: 1; font-size: 14px; }
    
    .habit-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 16px;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .stats {
      display: flex;
      gap: 16px;
      margin-top: 16px;
    }
    
    .stat {
      flex: 1;
      text-align: center;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 600;
      margin-top: 8px;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--muted);
    }
    
    input, select {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }
    
    .form-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .habit-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .habit-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
    }
    
    .habit-name { flex: 1; }
    
    .habit-type {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      margin-right: 8px;
    }
    
    .type-good { background: var(--good); color: white; }
    .type-bad { background: var(--bad); color: white; }
    
    .btn-delete {
      padding: 6px 12px;
      background: var(--bad);
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 12px;
    }
    
    .done-message {
      text-align: center;
      padding: 40px 20px;
      display: none;
    }
    
    .done-message.show { display: block; }
    
    .done-emoji { font-size: 48px; margin-bottom: 16px; }
    
    canvas {
      max-width: 100%;
      height: auto;
      margin-top: 16px;
    }
    
    .empty {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <header>
    <h1>üéØ –¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</h1>
    <div class="tabs">
      <div class="tab active" onclick="switchTab('review')">
        <div class="tab-icon">üìã</div>
        <div class="tab-label">–û—Ü–µ–Ω–∏—Ç—å</div>
      </div>
      <div class="tab" onclick="switchTab('stats')">
        <div class="tab-icon">üìä</div>
        <div class="tab-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
      </div>
      <div class="tab" onclick="switchTab('settings')">
        <div class="tab-icon">‚öôÔ∏è</div>
        <div class="tab-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      </div>
    </div>
  </header>

  <main id="review">
    <div class="card">
      <div class="card-title">–û—Ü–µ–Ω–∫–∞ –¥–Ω—è: <span id="dateLabel"></span></div>
      <div id="habitContainer"></div>
      <div id="doneMessage" class="done-message">
        <div class="done-emoji">‚úÖ</div>
        <h2>–î–µ–Ω—å –æ—Ü–µ–Ω—ë–Ω!</h2>
        <p style="margin-top: 8px; color: var(--muted)">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</p>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–Ω—è</div>
      <canvas id="ringChart" width="200" height="200"></canvas>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">–í—Å–µ–≥–æ</div>
          <div class="stat-value" id="totalCount">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">–£—Å–ø–µ—Ö</div>
          <div class="stat-value" style="color: var(--good)" id="goodCount">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">–ü—Ä–æ–≤–∞–ª</div>
          <div class="stat-value" style="color: var(--bad)" id="badCount">0</div>
        </div>
      </div>
    </div>
  </main>

  <main id="stats" hidden>
    <div class="card">
      <div class="card-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π</div>
      <canvas id="weekChart" width="600" height="300"></canvas>
    </div>
    <div class="card">
      <div class="card-title">üî• –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">–î–Ω–µ–π –æ—Ü–µ–Ω–µ–Ω–æ</div>
          <div class="stat-value" id="daysCount">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
          <div class="stat-value" style="color: var(--good)" id="avgScore">0%</div>
        </div>
      </div>
    </div>
  </main>

  <main id="settings" hidden>
    <div class="card">
      <div class="card-title">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ã—á–µ–∫</div>
      <div class="form-row">
        <input id="habitName" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏" style="flex: 2">
        <select id="habitType" style="flex: 1">
          <option value="good">–•–æ—Ä–æ—à–∞—è</option>
          <option value="bad">–ü–ª–æ—Ö–∞—è</option>
        </select>
        <button class="btn" style="background: var(--primary); font-size: 14px; padding: 10px 16px;" onclick="addHabit()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div id="habitList" class="habit-list"></div>
    </div>
    
    <div class="card">
      <div class="card-title">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
      <div style="display: flex; gap: 8px;">
        <button class="btn" style="background: var(--primary); font-size: 14px; padding: 10px 16px; flex: 1;" onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button class="btn" style="background: var(--primary); font-size: 14px; padding: 10px 16px; flex: 1;" onclick="importData()">üì• –ò–º–ø–æ—Ä—Ç</button>
        <input type="file" id="importFile" accept=".json" style="display: none" onchange="handleImport(event)">
      </div>
    </div>
  </main>

  <script>
    // –•—Ä–∞–Ω–∏–ª–∏—â–µ
    const storage = {
      habits: [],
      reviews: {}
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    function loadData() {
      const saved = localStorage.getItem('habitTracker');
      if (saved) {
        const data = JSON.parse(saved);
        storage.habits = data.habits || [];
        storage.reviews = data.reviews || {};
      }
      if (storage.habits.length === 0) {
        storage.habits = [
          { id: Date.now(), name: '–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞', type: 'good' },
          { id: Date.now() + 1, name: '–ü—Ä–æ—á–∏—Ç–∞—Ç—å 20 —Å—Ç—Ä–∞–Ω–∏—Ü', type: 'good' },
          { id: Date.now() + 2, name: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è 10 –º–∏–Ω', type: 'good' }
        ];
        saveData();
      }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function saveData() {
      localStorage.setItem('habitTracker', JSON.stringify(storage));
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—á–µ—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã
    function getYesterday() {
      const date = new Date();
      date.setDate(date.getDate() - 1);
      return date.toISOString().split('T')[0];
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('main').forEach(m => m.hidden = true);
      
      event.target.closest('.tab').classList.add('active');
      document.getElementById(tab).hidden = false;
      
      if (tab === 'review') renderReview();
      if (tab === 'stats') renderStats();
      if (tab === 'settings') renderSettings();
    }

    // –†–µ–Ω–¥–µ—Ä –æ—Ü–µ–Ω–∫–∏
    let currentHabitIndex = 0;
    const reviewDate = getYesterday();

    function renderReview() {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      document.getElementById('dateLabel').textContent = yesterday.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
      
      if (!storage.reviews[reviewDate]) {
        storage.reviews[reviewDate] = {};
      }
      
      const unevaluated = storage.habits.filter(h => !storage.reviews[reviewDate].hasOwnProperty(h.id));
      
      if (unevaluated.length === 0) {
        document.getElementById('habitContainer').innerHTML = '';
        document.getElementById('doneMessage').classList.add('show');
      } else {
        document.getElementById('doneMessage').classList.remove('show');
        const habit = unevaluated[0];
        document.getElementById('habitContainer').innerHTML = `
          <div class="habit-card" style="background: linear-gradient(135deg, ${habit.type === 'good' ? '#667eea, #764ba2' : '#f093fb, #f5576c'})">${habit.name}</div>
          <div class="actions">
            <button class="btn btn-no" onclick="recordAnswer(${habit.id}, 'no')">‚úñÔ∏è</button>
            <button class="btn btn-na" onclick="recordAnswer(${habit.id}, 'na')">N/A</button>
            <button class="btn btn-yes" onclick="recordAnswer(${habit.id}, 'yes')">‚úîÔ∏è</button>
          </div>
        `;
      }
      
      updateDayStats();
    }

    // –ó–∞–ø–∏—Å—å –æ—Ç–≤–µ—Ç–∞
    function recordAnswer(habitId, answer) {
      storage.reviews[reviewDate][habitId] = answer;
      saveData();
      renderReview();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–Ω—è
    function updateDayStats() {
      const dayReviews = storage.reviews[reviewDate] || {};
      const total = storage.habits.length;
      const evaluated = Object.keys(dayReviews).length;
      const good = Object.values(dayReviews).filter(v => v === 'yes').length;
      const bad = Object.values(dayReviews).filter(v => v === 'no').length;
      
      document.getElementById('totalCount').textContent = total;
      document.getElementById('goodCount').textContent = good;
      document.getElementById('badCount').textContent = bad;
      
      const score = evaluated > 0 ? Math.round((good / evaluated) * 100) : 0;
      drawRing(score);
    }

    // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∫–æ–ª—å—Ü–∞
    function drawRing(score) {
      const canvas = document.getElementById('ringChart');
      const ctx = canvas.getContext('2d');
      const centerX = 100;
      const centerY = 100;
      const radius = 80;
      
      ctx.clearRect(0, 0, 200, 200);
      
      // –§–æ–Ω
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.strokeStyle = '#2a3648';
      ctx.lineWidth = 15;
      ctx.stroke();
      
      // –ü—Ä–æ–≥—Ä–µ—Å—Å
      if (score > 0) {
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, -0.5 * Math.PI, (-0.5 + (score / 100) * 2) * Math.PI);
        ctx.strokeStyle = score >= 70 ? '#4ade80' : score >= 40 ? '#fbbf24' : '#f87171';
        ctx.lineWidth = 15;
        ctx.lineCap = 'round';
        ctx.stroke();
      }
      
      // –¢–µ–∫—Å—Ç
      ctx.fillStyle = '#e8edf4';
      ctx.font = 'bold 36px -apple-system';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(score + '%', centerX, centerY);
    }

    // –†–µ–Ω–¥–µ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function renderStats() {
      const dates = Object.keys(storage.reviews).sort();
      document.getElementById('daysCount').textContent = dates.length;
      
      const scores = dates.map(date => {
        const dayReviews = storage.reviews[date];
        const evaluated = Object.keys(dayReviews).length;
        if (evaluated === 0) return 0;
        const good = Object.values(dayReviews).filter(v => v === 'yes').length;
        return Math.round((good / evaluated) * 100);
      });
      
      const avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
      document.getElementById('avgScore').textContent = avgScore + '%';
      
      drawWeekChart();
    }

    // –ì—Ä–∞—Ñ–∏–∫ –Ω–µ–¥–µ–ª–∏
    function drawWeekChart() {
      const canvas = document.getElementById('weekChart');
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      
      ctx.clearRect(0, 0, width, height);
      
      const dates = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        dates.push(date.toISOString().split('T')[0]);
      }
      
      const scores = dates.map(date => {
        const dayReviews = storage.reviews[date];
        if (!dayReviews || Object.keys(dayReviews).length === 0) return 0;
        const evaluated = Object.keys(dayReviews).length;
        const good = Object.values(dayReviews).filter(v => v === 'yes').length;
        return Math.round((good / evaluated) * 100);
      });
      
      const barWidth = width / dates.length;
      const maxHeight = height - 40;
      
      scores.forEach((score, i) => {
        const barHeight = (score / 100) * maxHeight;
        const x = i * barWidth + 20;
        const y = height - barHeight - 20;
        
        ctx.fillStyle = score >= 70 ? '#4ade80' : score >= 40 ? '#fbbf24' : '#f87171';
        ctx.fillRect(x, y, barWidth - 40, barHeight);
        
        ctx.fillStyle = '#e8edf4';
        ctx.font = '12px -apple-system';
        ctx.textAlign = 'center';
        ctx.fillText(score + '%', x + (barWidth - 40) / 2, y - 5);
      });
    }

    // –†–µ–Ω–¥–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function renderSettings() {
      const list = document.getElementById('habitList');
      if (storage.habits.length === 0) {
        list.innerHTML = '<div class="empty">–ù–µ—Ç –ø—Ä–∏–≤—ã—á–µ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</div>';
        return;
      }
      list.innerHTML = storage.habits.map(h => `
        <div class="habit-item">
          <span class="habit-name">${h.name}</span>
          <span class="habit-type ${h.type === 'good' ? 'type-good' : 'type-bad'}">
            ${h.type === 'good' ? '–•–æ—Ä–æ—à–∞—è' : '–ü–ª–æ—Ö–∞—è'}
          </span>
          <button class="btn-delete" onclick="deleteHabit(${h.id})">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      `).join('');
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
    function addHabit() {
      const name = document.getElementById('habitName').value.trim();
      const type = document.getElementById('habitType').value;
      
      if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏');
        return;
      }
      
      storage.habits.push({
        id: Date.now(),
        name: name,
        type: type
      });
      
      saveData();
      document.getElementById('habitName').value = '';
      renderSettings();
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
    function deleteHabit(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É?')) return;
      storage.habits = storage.habits.filter(h => h.id !== id);
      saveData();
      renderSettings();
    }

    // –≠–∫—Å–ø–æ—Ä—Ç
    function exportData() {
      const data = JSON.stringify(storage, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'habits-backup.json';
      a.click();
    }

    // –ò–º–ø–æ—Ä—Ç
    function importData() {
      document.getElementById('importFile').click();
    }

    function handleImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          storage.habits = data.habits || [];
          storage.reviews = data.reviews || {};
          saveData();
          alert('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
          renderSettings();
        } catch (err) {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö');
        }
      };
      reader.readAsText(file);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    loadData();
    renderReview();
  </script>
</body>
</html>